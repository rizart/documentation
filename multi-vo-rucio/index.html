<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.74">
<link rel="alternate" type="application/rss+xml" href="/documentation/blog/rss.xml" title="Rucio Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documentation/blog/atom.xml" title="Rucio Documentation Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Rucio Documentation" href="/documentation/opensearch.xml">
<link rel="stylesheet" href="/documentation/css/custom.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">Multi-VO Rucio | Rucio Documentation</title><meta data-react-helmet="true" property="og:url" content="https://rucio.github.io/documentation/multi-vo-rucio"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Multi-VO Rucio | Rucio Documentation"><meta data-react-helmet="true" name="description" content="This section provides an overview of using Rucio for multiple virtual"><meta data-react-helmet="true" property="og:description" content="This section provides an overview of using Rucio for multiple virtual"><link data-react-helmet="true" rel="shortcut icon" href="/documentation/img/android-chrome-512x512.png"><link data-react-helmet="true" rel="canonical" href="https://rucio.github.io/documentation/multi-vo-rucio"><link data-react-helmet="true" rel="alternate" href="https://rucio.github.io/documentation/multi-vo-rucio" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://rucio.github.io/documentation/multi-vo-rucio" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/documentation/assets/css/styles.be616fc4.css">
<link rel="preload" href="/documentation/assets/js/styles.cfa2b2ef.js" as="script">
<link rel="preload" href="/documentation/assets/js/runtime~main.f292a594.js" as="script">
<link rel="preload" href="/documentation/assets/js/main.3ffcba5d.js" as="script">
<link rel="preload" href="/documentation/assets/js/1.addcfd93.js" as="script">
<link rel="preload" href="/documentation/assets/js/2.6387e4ac.js" as="script">
<link rel="preload" href="/documentation/assets/js/375.48339df4.js" as="script">
<link rel="preload" href="/documentation/assets/js/378.a3d6a22b.js" as="script">
<link rel="preload" href="/documentation/assets/js/935f2afb.89cc8618.js" as="script">
<link rel="preload" href="/documentation/assets/js/17896441.4eede5ee.js" as="script">
<link rel="preload" href="/documentation/assets/js/23ac1d8e.591c9ad4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Rucio Documentation</strong></a><a class="navbar__item navbar__link" href="/documentation/client_api/accountclient">Python Client API</a><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">REST API</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/documentation/"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Rucio Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/documentation/client_api/accountclient">Python Client API</a></li><li class="menu__list-item"><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="menu__link">REST API</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><main class="docMainContainer_r8cw docMainContainerEnhanced_SOUu"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Multi-VO Rucio</h1></header><div class="markdown"><p>This section provides an overview of using Rucio for multiple virtual
organizations (VOs) on a single instance with the &quot;Multi-VO&quot; feature. Rather
than each VO having to set up an entire instance by themselves, they can share
the same server and database which are run by a central &quot;super_root&quot;, and
continue to use Rucio as they would a normal or &quot;Single-VO&quot; instance. Their
accounts, scopes and RSEs are associated with their VO which ensures all rules
and replicas are kept separate from other VOs using the instance.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="changes-to-the-client"></a>Changes to the Client<a class="hash-link" href="#changes-to-the-client" title="Direct link to heading">#</a></h2><p>At the CLI and client level there are few changes to how Rucio is used. These
cases, such as optional arguments for VO, are covered in documentation for the
affected function. The main change is the addition of two options in the
<code>rucio.cfg</code> file, one to flag that the instance is being run in M-VO mode and
another to specify the VO the users belong to:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cfg"><div tabindex="0" class="prism-code language-cfg codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[common]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">multi_vo = True</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[client]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">vo = abc</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="changes-to-the-ruciocfg-on-the-server-and-daemons"></a>Changes to the rucio.cfg on the Server and Daemons<a class="hash-link" href="#changes-to-the-ruciocfg-on-the-server-and-daemons" title="Direct link to heading">#</a></h2><p>Similar settings need to be changed on the server and daemon rucio.cfg files as
well as on the client end.  For the server <code>multi_vo</code> should also be set in the
config file.  For the daemons another section is needed to be added, this is to
map each VO to its own proxy certificate. Rucio uses this information when
submitting and polling transfers to use the correct certificates.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI cfg"><div tabindex="0" class="prism-code language-cfg codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[vo_certs]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;3 char vo name&gt; = &lt;path/to/vo/proxy&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>It is recommended that the proxies are placed in /tmp/x509up_&lt;VO&gt;, and the
certificates and keys are placed in /opt/rucio/certs/&lt;VO&gt;/ and
/opt/rucio/keys/&lt;VO&gt;/ respectively.</p><p>However, <code>vo</code> should not be set for the server or the daemons as these parts of
Rucio are not associated with a single VO. If <code>multi_vo</code> is not set, or set to
False, then Rucio will operate normally.</p><p>Similar settings need to be changed on the server and daemon rucio.cfg files as
well as on the client end.  For the server <code>multi_vo</code> should also be set in the
config file.  For the daemons another section is needed to be added, this is to
map each VO to its own proxy certificate. Rucio uses this information when
submitting and polling transfers to use the correct certificates.  &#x27;&#x27;&#x27;cfg
[vo_certs] ...  &lt;3 char vo name&gt; = &lt;path/to/vo/proxy&gt; &#x27;&#x27;&#x27; However, <code>vo</code> should
not be set for the server or the daemons as these parts of Rucio are not
associated with a single VO. If <code>multi_vo</code> is not set, or set to False, then
Rucio will operate normally.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="role-of-the-super_root"></a>Role of the super_root<a class="hash-link" href="#role-of-the-super_root" title="Direct link to heading">#</a></h2><p>While root accounts still retain their administrative role within a VO, for
example adding RSEs and accounts, functions relating to the creation and
management of VOs is handled by the super_root account, a concept introduced
with M-VO Rucio. It is worth noting that the super_root account <strong>cannot</strong> be
used to perform individual VO administration; the roles of super_root and root
are distinct.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="access-of-super_root-functions"></a>Access of super_root Functions<a class="hash-link" href="#access-of-super_root-functions" title="Direct link to heading">#</a></h2><p>As the super_root functions aren&#x27;t intended for use by normal users of admins,
they do not have an implementation in the client or CLI. They can be accessed
from the core or the :ref:<code>vo-rest-api</code>, however the latter will require the VO
endpoint to be added to the aliases file used when setting up the server as it
is disabled by default.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="starting-a-m-vo-instance"></a>Starting a M-VO Instance<a class="hash-link" href="#starting-a-m-vo-instance" title="Direct link to heading">#</a></h2><p>When bootstrapping the database as part of the Rucio installation, if M-VO is
enabled in <code>rucio.cfg</code> then the super_root account is created automatically. The
default VO &quot;def&quot; is also created, and the super_root acccount is associated with
it. The identity used to access this account can be managed in the usual way.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="creating-vos"></a>Creating VOs<a class="hash-link" href="#creating-vos" title="Direct link to heading">#</a></h2><p>When creating a new VO with the <code>add_vo</code> function you need to specify the three
digit identifier for the new VO, which can contain letters and numbers. This
must be unique for the instance. A more complete description can also be
optionally included, along with an email to use for the root of this new VO. In
addition to creating the new VO, a root account is also created for this VO, and
has all identities associated with super_root added to it. The identities for
the new root can then be configured as usual.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="managing-vos"></a>Managing VOs<a class="hash-link" href="#managing-vos" title="Direct link to heading">#</a></h2><p>In addition to creating VOs, the description and email for a VO can be altered
using <code>update_vo</code>. If the root user of a VO loses access to their account, the
super_root can associate a new identity with it using
<code>recover_vo_root_identity</code>. Finally, a list of current VOs and their
descriptions is accessible via <code>list_vos</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="long-vo-name-mapping"></a>Long VO Name Mapping<a class="hash-link" href="#long-vo-name-mapping" title="Direct link to heading">#</a></h2><p>The rucio database stores all VO references as a single three-character tag for
performance reasons. It&#x27;s possible to create aliases for these tag to allow
users/clients to specify long VO names when getting a token (and modifying VOs)
and have these converted to the internal tag automatically. Long VO names should
only use the basic DNS name character set of alphanumber charaters, hyphen and
dot (a-zA-Z0-9-.). The alias mappings are stored in the vo-map section of the
configs database table and can be edited via the usual methods for modifying
this config. The option name is the long VO name and the value is the short
name; for example these can be added using the CLI:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rucio-admin config </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">set</span><span class="token plain"> --section vo-map --option my.long.vo --value mlv</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">rucio-admin config </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">set</span><span class="token plain"> --section vo-map --option another.vo --value ant</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>You may specify more than one alias for a VO if required.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="converting-existing-instances"></a>Converting Existing Instances<a class="hash-link" href="#converting-existing-instances" title="Direct link to heading">#</a></h2><p>As opposed to starting a new M-VO instance from scratch, it may be desirable to
convert the database for an existing (S-VO) Rucio instance into a M-VO instance
so that additional VOs can be added without disrupting the original VO or
needing to create a second instance. Conversely, one VO within a M-VO instance
may grow to the point where it needs its own dedicated instance, and so
converting data from M-VO to S-VO may also be desirable. These operations can be
performed using utility functions included with Rucio.</p><p>As mentioned above, in order to configure a M-VO instance of Rucio only the
config file needs to change. However for an existing instance any entries
already in the database will not be associated with a VO (or associated with
their old one if previously in M-VO mode). In order to change these, direct
operations on the database are required. These commands are generated using
SQLAlchemy, and can either be run directly on the database or printed out and
run manually.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="practicalities"></a>Practicalities<a class="hash-link" href="#practicalities" title="Direct link to heading">#</a></h2><p>Before attempting to convert existing data, it is recommended that a backup of
the database is taken in case an issue arises. Furthermore, of the databases
supported by Rucio, only PostgreSQL has been tested on real data. Based on this
test (which was performed on a machine with 64GB memory and four Intel Xeon
E5-2430 v2), the tables with 2 columns that needed updating were converted at a
rate of 5GB of data per hour. However many tables do not need any changes, so
the process will likely be faster than this in practice. Another approach to
speed up the conversion is to skip the &quot;history&quot; tables, as these can be very
large. Unlike other tables these do not have foreign key constraints set, and so
do not need to be updated in order to use the database. While the history will
be inaccessible from the new VO, it will still exist in the database and could
be accessed using the <code>super_root</code> account if needed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="s-vo-to-m-vo"></a>S-VO to M-VO<a class="hash-link" href="#s-vo-to-m-vo" title="Direct link to heading">#</a></h2><p>Before starting, ensure that <code>multi_vo</code> is set to <code>True</code> in the config file.
The SQL commands needed to convert the database involve dropping foreign key
constraints that affect accounts/scopes, then altering the relevant columns,
before re-adding the constraints. The 3 character identifier for the VO, a full
description and an admin email should be provided:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ tools/convert_database_vo.py convert_to_mvo new </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;New VO for existing data&quot;</span><span class="token plain"> rucio@email.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ALTER TABLE account_limits DROP CONSTRAINT </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ACCOUNT_LIMITS_ACCOUNT_FK&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">UPDATE account_limits SET </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">account</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">split_part</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">account_limits.account, </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@&#x27;</span><span class="token plain">, </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@new&#x27;</span><span class="token plain"> AS CHAR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> WHERE </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    split_part</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">account_limits.account, </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@&#x27;</span><span class="token plain">, </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ALTER TABLE account_limits ADD CONSTRAINT </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ACCOUNT_LIMITS_ACCOUNT_FK&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  FOREIGN KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> REFERENCES accounts </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>In this example, no changes will be made to the database by running the script,
and so the SQL will need to be run manually. After running the commands, a
<code>super_root</code> account should be setup to allow administrative functions like
adding more VOs:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ python</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> from rucio.db.sqla.util </span><span class="token function" style="color:rgb(130, 170, 255)">import</span><span class="token plain"> create_root_account</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> create_root_account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">create_counters</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Alternatively by specifying <code>--commit_changes</code> the script will attempt to
modify the database as it runs, however this requires the account used by the
Rucio instance to access the database to be the owner of the the tables. In
this case, the <code>super_root</code> account can be added as part of the script by
passing the argument <code>--create_super_root</code>. If there is an error during the
conversion, then none of the changes will be committed.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ tools/convert_database_vo.py --commit_changes </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  convert_to_mvo new </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;New VO for existing data&quot;</span><span class="token plain"> rucio@email.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --create_super_root</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Finally, there is the option to skip the (potentially very large) tables of
historical data using <code>--skip_history</code>. In this case the commands to alter those
tables are omitted:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ tools/convert_database_vo.py --skip_history </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  convert_to_mvo new </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;New VO for existing data&quot;</span><span class="token plain"> rucio@email.com</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="m-vo-to-s-vo"></a>M-VO to S-VO<a class="hash-link" href="#m-vo-to-s-vo" title="Direct link to heading">#</a></h2><p>Before starting, ensure that <code>multi_vo</code> is set to <code>True</code> in the config file
(this option can be removed after completing the conversion). The first stage of
the conversion is the same as before, dropping foreign key constraints and
renaming the entries that were associated with the old VO. The name of this VO
is the only required argument: <code>bash $ tools/convert_database_vo.py
convert_to_svo old ALTER TABLE account_limits DROP CONSTRAINT
&quot;ACCOUNT_LIMITS_ACCOUNT_FK&quot;; ...  UPDATE account_limits SET
account=split_part(account_limits.account, &#x27;@&#x27;, 1) WHERE
split_part(account_limits.account, &#x27;@&#x27;, 2) = &#x27;old&#x27;; ...  ALTER TABLE
account_limits ADD CONSTRAINT &quot;ACCOUNT_LIMITS_ACCOUNT_FK&quot; FOREIGN KEY(account)
REFERENCES accounts (account); </code> By default data associated with any other VOs
is left in the database, but will be inaccessible to Rucio users. By setting
pass the argument <code>--delete_vos</code>, these entries will be deleted from the
database completely:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">tools/convert_database_vo.py convert_to_svo old --delete_vos </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  DELETE FROM account_limits WHERE </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    split_part</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">account_limits.account, </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@&#x27;</span><span class="token plain">, </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;xyz&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.  DELETE FROM account_limits WHERE </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    split_part</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">account_limits.account, </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@&#x27;</span><span class="token plain">, </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;123&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Once again, historical tables skipped with <code>--skip_history</code>, and the commands
can be run directly against the database using the <code>--commit_changes</code> argument;
if this is not set then the <code>super_root</code> account should be manually deleted
after running the SQL: <code>bash $ python &gt;&gt;&gt; from rucio.common.types import
InternalAccount &gt;&gt;&gt; from rucio.core.account import del_account &gt;&gt;&gt;
del_account(InternalAccount(&#x27;super_root&#x27;, vo=&#x27;def&#x27;)) </code></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/rucio/documentation/tree/main/docs/../docs/multi_vo_rucio.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2022-10-26T15:49:44.000Z" class="lastUpdatedDate_nN9m">10/26/2022</time> by <strong>Rizart Dona</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#changes-to-the-client" class="table-of-contents__link">Changes to the Client</a></li><li><a href="#changes-to-the-ruciocfg-on-the-server-and-daemons" class="table-of-contents__link">Changes to the rucio.cfg on the Server and Daemons</a></li><li><a href="#role-of-the-super_root" class="table-of-contents__link">Role of the super_root</a></li><li><a href="#access-of-super_root-functions" class="table-of-contents__link">Access of super_root Functions</a></li><li><a href="#starting-a-m-vo-instance" class="table-of-contents__link">Starting a M-VO Instance</a></li><li><a href="#creating-vos" class="table-of-contents__link">Creating VOs</a></li><li><a href="#managing-vos" class="table-of-contents__link">Managing VOs</a></li><li><a href="#long-vo-name-mapping" class="table-of-contents__link">Long VO Name Mapping</a></li><li><a href="#converting-existing-instances" class="table-of-contents__link">Converting Existing Instances</a></li><li><a href="#practicalities" class="table-of-contents__link">Practicalities</a></li><li><a href="#s-vo-to-m-vo" class="table-of-contents__link">S-VO to M-VO</a></li><li><a href="#m-vo-to-s-vo" class="table-of-contents__link">M-VO to S-VO</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></div><div class="footer__copyright">Copyright Â© 2022 CERN</div></div></div></footer></div>
<script src="/documentation/assets/js/styles.cfa2b2ef.js"></script>
<script src="/documentation/assets/js/runtime~main.f292a594.js"></script>
<script src="/documentation/assets/js/main.3ffcba5d.js"></script>
<script src="/documentation/assets/js/1.addcfd93.js"></script>
<script src="/documentation/assets/js/2.6387e4ac.js"></script>
<script src="/documentation/assets/js/375.48339df4.js"></script>
<script src="/documentation/assets/js/378.a3d6a22b.js"></script>
<script src="/documentation/assets/js/935f2afb.89cc8618.js"></script>
<script src="/documentation/assets/js/17896441.4eede5ee.js"></script>
<script src="/documentation/assets/js/23ac1d8e.591c9ad4.js"></script>
</body>
</html>