<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.74">
<link rel="alternate" type="application/rss+xml" href="/documentation/blog/rss.xml" title="Rucio Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documentation/blog/atom.xml" title="Rucio Documentation Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Rucio Documentation" href="/documentation/opensearch.xml">
<link rel="stylesheet" href="/documentation/css/custom.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">Type Annotation Guide | Rucio Documentation</title><meta data-react-helmet="true" property="og:url" content="https://rucio.github.io/documentation/type_annotation_guide"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Type Annotation Guide | Rucio Documentation"><meta data-react-helmet="true" name="description" content="The purpose of this document is to collaboratively create the developer"><meta data-react-helmet="true" property="og:description" content="The purpose of this document is to collaboratively create the developer"><link data-react-helmet="true" rel="shortcut icon" href="/documentation/img/android-chrome-512x512.png"><link data-react-helmet="true" rel="canonical" href="https://rucio.github.io/documentation/type_annotation_guide"><link data-react-helmet="true" rel="alternate" href="https://rucio.github.io/documentation/type_annotation_guide" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://rucio.github.io/documentation/type_annotation_guide" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/documentation/assets/css/styles.be616fc4.css">
<link rel="preload" href="/documentation/assets/js/styles.0e925561.js" as="script">
<link rel="preload" href="/documentation/assets/js/runtime~main.ca0eb878.js" as="script">
<link rel="preload" href="/documentation/assets/js/main.b4a61254.js" as="script">
<link rel="preload" href="/documentation/assets/js/1.c84e6daf.js" as="script">
<link rel="preload" href="/documentation/assets/js/2.e9cef96e.js" as="script">
<link rel="preload" href="/documentation/assets/js/378.e0a12efe.js" as="script">
<link rel="preload" href="/documentation/assets/js/381.ba0865de.js" as="script">
<link rel="preload" href="/documentation/assets/js/935f2afb.367d78a1.js" as="script">
<link rel="preload" href="/documentation/assets/js/17896441.35502a5f.js" as="script">
<link rel="preload" href="/documentation/assets/js/f8659546.095d8f14.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Rucio Documentation</strong></a><a class="navbar__item navbar__link" href="/documentation/client_api/accountclient">Python Client API</a><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">REST API</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/documentation/"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Rucio Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/documentation/client_api/accountclient">Python Client API</a></li><li class="menu__list-item"><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="menu__link">REST API</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><div class="docSidebarContainer_0YBq" role="complementary"><div class="sidebar_a3j0"><div class="menu menu--responsive thin-scrollbar menu_cyFh"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/documentation/">Welcome</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/before_you_get_started">Before you get started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/what_is_rucio">What is Rucio?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/main_components">Main Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/additional_layers_and_resources">Additional Layers and Resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/requirements">Requirements</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/rucio_account">Rucio account</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/file_dataset_container">Files, Datasets, and Containers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/rucio_storage_element">Rucio Storage Element</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/metadata_attributes">Metadata attributes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/permission_model">Permission model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/replica_management">Replica management with replication rules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/replication_rules_examples">Replication rule examples</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/rse_expressions">RSE Expressions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/accounting_and_quota">Accounting and quota</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/notifications">Notifications</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/subscriptions">Subscriptions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/replica_workflow">Typical Replica Workflow</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/releasepolicy">Release Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/release-notes">Release Notes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/setting_up_the_rucio_client">Setting Up the Rucio Client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/using_the_client">Using the Client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/using_the_admin_client">Using the Admin Client</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Python Client API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/accountclient">AccountClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/accountlimitclient">AccountLimitClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/baseclient">BaseClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/client">Client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/configclient">ConfigClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/credentialclient">CredentialClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/didclient">DIDClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/diracclient">DiracClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/downloadclient">DownloadClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/exportclient">ExportClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/fileclient">FileClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/importclient">ImportClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/lifetimeclient">LifetimeClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/lockclient">LockClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/metaclient">MetaClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/pingclient">PingClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/replicaclient">ReplicaClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/requestclient">RequestClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/rseclient">RSEClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/ruleclient">RuleClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/scopeclient">ScopeClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/subscriptionclient">SubscriptionClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/touchclient">TouchClient</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/client_api/uploadclient">UploadClient</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Operator</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/installing_server">Installing Rucio Server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/installing_daemons">Installing Rucio Daemons</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/monitoring">Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/database">Database Operations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/administration">Administration Tricks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/configuration_parameters">Configuration parameters</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Transfers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/transfers-overview">Transfers Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/transfers-submitter">Transfers Submitter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/configure-rucio-globus">Configure Rucio To Use Globus Online as a Transfer Tool</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/policy_packages">Policy Packages</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/s3_rse_config">S3 Storage Configuration</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Executables</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-abacus-account">rucio-abacus-account</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-abacus-collection-replica">rucio-abacus-collection-replica</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-abacus-rse">rucio-abacus-rse</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-admin">rucio-admin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-atropos">rucio-atropos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-auditor">rucio-auditor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-automatix">rucio-automatix</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-bb8">rucio-bb8</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-c3po">rucio-c3po</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-cache-client">rucio-cache-client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-cache-consumer">rucio-cache-consumer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-conveyor-finisher">rucio-conveyor-finisher</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-conveyor-poller">rucio-conveyor-poller</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-conveyor-preparer">rucio-conveyor-preparer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-conveyor-receiver">rucio-conveyor-receiver</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-conveyor-stager">rucio-conveyor-stager</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-conveyor-submitter">rucio-conveyor-submitter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-conveyor-throttler">rucio-conveyor-throttler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-dark-reaper">rucio-dark-reaper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-dumper">rucio-dumper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-follower">rucio-follower</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-hermes">rucio-hermes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-hermes2">rucio-hermes2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-judge-cleaner">rucio-judge-cleaner</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-judge-evaluator">rucio-judge-evaluator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-judge-injector">rucio-judge-injector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-judge-repairer">rucio-judge-repairer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-kronos">rucio-kronos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-light-reaper">rucio-light-reaper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-minos-temporary-expiration">rucio-minos-temporary-expiration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-minos">rucio-minos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-necromancer">rucio-necromancer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-oauth-manager">rucio-oauth-manager</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-reaper">rucio-reaper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-replica-recoverer">rucio-replica-recoverer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-storage-consistency-actions">rucio-storage-consistency-actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-transmogrifier">rucio-transmogrifier</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio-undertaker">rucio-undertaker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/bin/rucio">rucio</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Developer</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/setting_up_demo">Setting up a Rucio demo environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/developing_with_rucio">Developing with Rucio</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/contributing">Contributing Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/rest_api_doc">Rest Api Documentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/component_leads">Component leads</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/documentation/type_annotation_guide">Type Annotation Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About Us</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/about_our_contributors">About Our Contributors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/documentation/contact_us">Contact us</a></li></ul></li></ul></div></div></div><main class="docMainContainer_r8cw"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Type Annotation Guide</h1></header><div class="markdown"><p>The purpose of this document is to collaboratively create the developer
guidelines for static type checking of rucio&#x27;s codebase.</p><p><strong>TL;DR</strong> New code has to be type annotated, old code should be migrated. Look
into <a href="#Best-Practices">Best Practices</a> for specific instructions on how to use
it in our repository.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="abstract"></a>Abstract<a class="hash-link" href="#abstract" title="Direct link to heading">#</a></h2><p>Python is a dynamically-typed programming language. Dynamic type checked
programming languages verify the type safety at runtime. Type-related bugs thus
occur at runtime. Tests are in place to check the types and prevent
bugs. However, tests do not always cover all possible combinations of types.</p><p><a href="https://peps.python.org/pep-0484/" target="_blank" rel="noopener noreferrer">PEP 484</a>, which got adopted into the <em>Python
Language Reference</em> of Python3.6 and is thus a part of Python itself, introduces
<em>type hints</em> to Python. Type hints add more information to the source code and
allow us to automatically check the code for type missmatches. Type-related bugs
will thereby be checked at compile time (pre-runtime), rather than at
runtime. Type hints also increase the descriptiveness of our code and make it
easier to read.</p><p>Rucio does not has type hints at the moment. The plan is to introduce them
consistently to the entire project. Adding type hints to a big project is
challenging. Since the code-base is too large to introduce them with only one
PR, we will introduce the hints incrementally.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="type-annotations"></a>Type Annotations<a class="hash-link" href="#type-annotations" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="general-information"></a>General Information<a class="hash-link" href="#general-information" title="Direct link to heading">#</a></h3><ul><li><a href="https://peps.python.org/pep-0483/" target="_blank" rel="noopener noreferrer"><strong>PEP 483 â€“ The Theory of Type Hints</strong></a>
This <em>PEP</em> explains the theory behind type hints, as well as backgrounds to
certain decisions.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="syntax"></a>Syntax<a class="hash-link" href="#syntax" title="Direct link to heading">#</a></h3><p>There are comprehensive and descriptive documentations on the web on how to
annotate python code with type hints. E.g.:</p><ul><li><p><a href="https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html" target="_blank" rel="noopener noreferrer"><strong>MyPy type hints cheat
sheet</strong></a> The cheat
sheet contains information on the syntax of type annotations and <em>which ones</em>
to use <em>when</em>.</p></li><li><p><a href="https://peps.python.org/pep-0484/" target="_blank" rel="noopener noreferrer"><strong>PEP 484 â€“ Type Hints</strong></a> Contains general
information about type hints in Python. This includes the motivation, the
definition, what to do with edge cases, and much more.</p></li><li><p><a href="https://peps.python.org/pep-0589/" target="_blank" rel="noopener noreferrer"><strong>PEP 589 â€“ TypedDict: Type Hints for Dictionaries with a Fixed Set of
Keys</strong></a> Explains how to use <code>TypedDict</code> and
what to regard while using them.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="why"></a>Why<a class="hash-link" href="#why" title="Direct link to heading">#</a></h2><p>Dynamically typed programming languages execute many common programming
behaviours, that static programming languages perform during compilation, at
runtime. While this is leads to quick prototyping, big projects could suffer
from some consequences. In particular:</p><ul><li>The code is harder to read: Parameters and return types are specified in typed
languages, they give some hints on how to call a function and what to
expect. Bugs and inconsistencies can be spotet easier (e.g. when a &quot;get&quot;
function return a list), and some IDEs display these information for a more
convenient coding experience. All of this is missing in dynamically typed
programming languages.</li><li>Type related bugs do not get noticed: Calling a function with a wrong type
(e.g. <code>None</code>) gets spotet by typed checkers. In dynamically typed programming
languages this needs to be veryfied on every call.</li></ul><p>While we have strong arguments for type annotations, there are some drawbacks:</p><ul><li>It takes more time to write code: The type annotations need to be specified
and added, which is tedious in a big code base.</li><li>They add little value if dicts are used heavily: The keys of dicts are not
type checked, only the potential values. Big dictionaries thus have a lot of
different value types, while the check if a key exists still needs to be done.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="type-annotations-in-rucio"></a>Type Annotations in Rucio<a class="hash-link" href="#type-annotations-in-rucio" title="Direct link to heading">#</a></h2><p>Adding type annotations is not always trivial. Some types might be to ambigous,
some might be to generic. A good reference point is existing type annotated
<em>Rucio</em> code. It will give hints on what types may be used and how to properly
used them in the code.</p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>Don&#x27;t just copy the types from existing code, think about them!</p><p>Ask yourself: Is this use-case the same? Could I be more specific than just
<code>Any</code>. Could I use a class instead of a <code>Dict</code>? Should I introduce a new type
instead of using an existing one? ...</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="what-not-to-type-annotate"></a>What not to type annotate<a class="hash-link" href="#what-not-to-type-annotate" title="Direct link to heading">#</a></h3><p>Not all Python code needs type annotations. Type annotations in the <code>tests</code>, for
example, would just add clutter and add very little benefits.</p><p>The following modules will <strong>not</strong> be type annotated:</p><ul><li><code>tools</code><ul><li>The tools folder contains some Python scripts. While type annotations
would help fixing bugs, the code itself is not shipped and will not be run
in a production environment.</li><li>We could add support later, however this is not our main concern atm.</li></ul></li><li><code>bin</code><ul><li>The Rucio executables don&#x27;t call the core or api call directly, but rather
use the client. We could activate it once to Python2 support is dropped.</li></ul></li><li><code>lib/rucio/tests</code><ul><li>The tests are volatile and should be easy to change. Type annotations
would just add clutter and very little benefits.</li></ul></li><li><code>lib/rucio/db</code><ul><li>The db module is used as a dependency of core. While we need the types, we
use very little functions out of it. We might activate support later,
however we want to focus on core right now.</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="dependencies"></a>Dependencies<a class="hash-link" href="#dependencies" title="Direct link to heading">#</a></h3><p>To properly use the benefits of type annotated code, we also have to look into
our dependencies. All of our frequently used dependencies provide type
annotations out of the box or via extensions:</p><ul><li><em>Python standard library</em><ul><li>Typehints were added in 3.5.0</li></ul></li><li><code>sqlalchemy</code><ul><li>Type hints were introduced in version 2.0</li><li><code>sqlalchemy-stubs</code> provide types for versions &lt; 2.0</li></ul></li><li><code>alembic</code><ul><li>Type hints are provided. Not important at the moment, since we are not
adding type hints for the db migration.</li></ul></li><li><code>flask</code><ul><li>Type hints are provided</li></ul></li><li><code>six</code><ul><li>The <code>types-six</code> package provides typehints.</li><li><code>six</code> might be removed from the repository in the future.</li></ul></li><li><code>requests</code><ul><li>The <code>types-requests</code> package provides typehints.</li></ul></li></ul><p>Some types from our dependencies, like the <em>sqlalchemy</em> <code>orm.session.Session</code>,
can be used directly. It is not needed to create our own equivalent then, except
if they get translated to a rucio owned type.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="github-actions"></a>GitHub Actions<a class="hash-link" href="#github-actions" title="Direct link to heading">#</a></h3><p>A GitHub actions job ensures that newly written code contains type hints:</p><p>The <code>Check Python Type Annotations</code> job in the autotests checks, if new code
contains type annotations. It does this by comparing the number of missing
python type annotations before the changes with the number of missing python
type annotations after the changes. If the number before is less then the number
after, new code, which is not typed, was added. The script then exits with a
non-zero exit code. If it is equals or bigger, type annotations have been added
to the repository.</p><p>As of now, only the number of <em>missing</em> type annotations will be used. The job
does not check for wrong type hints or inconsistencies. This (specifically
<code>mypy</code>) will be enabled once enough python type hints are added. For this
purpose, we will always add type annotations to functions, even when the type
can be infered.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="best-practices"></a>Best Practices<a class="hash-link" href="#best-practices" title="Direct link to heading">#</a></h3><p>To ensure a consistent usage of type hints, you should pay attention to the
following best practices:</p><p><strong>Use <em>Python 3.6</em> style type hints</strong></p><ul><li>There are multiple ways to specify type hints in Python. We agreed to use
the Python 3.6 style, since it&#x27;s easy to read and we don&#x27;t need the
backwards-compatibility.</li><li>E.g. favor <code>def add_rse(rse: str, vo: str = &#x27;def&#x27;, ...) -&gt; str:</code> over <code>def
add_rse(rse, vo=&#x27;def&#x27;, ...): # type: (str, str, ...) -&gt; str</code></li><li>Don&#x27;t use Python 3.6 incompatible features, this includes:<ul><li>The <a href="https://docs.python.org/3/library/stdtypes.html#types-union" target="_blank" rel="noopener noreferrer"><code>Union type expression &quot;(int |
None)&quot;</code></a>,
this got introduces in Pyhton 3.10</li><li><a href="https://docs.python.org/3/library/typing.html#typing.TypeAlias" target="_blank" rel="noopener noreferrer"><code>typing.TypeAlias</code></a>,
this got introduced in Python 3.10</li><li><a href="https://docs.python.org/3/library/typing.html#typing.Final" target="_blank" rel="noopener noreferrer"><code>typing.Final</code></a>,
introduced in Python 3.8. (Sad, since it is quite handy to let the type
checker check for constant re-assignments. :( )</li><li>Paramterized Python buildin types like <code>list</code>, <code>dict</code>, <code>set</code>, ...<ul><li>Parameterized buildin types are recognized by type checkers since
Python version 3.9. This follows after <a href="https://peps.python.org/pep-0585/" target="_blank" rel="noopener noreferrer">PEP
585</a>. Use the <code>typing</code> module
instead.</li><li>The <code>__future__</code> module provides a <a href="https://docs.python.org/3/library/__future__.html" target="_blank" rel="noopener noreferrer">backport for parameterized buildin
types</a> for
Python3.7+. This is not suitable for Python3.6</li><li><a href="https://docs.python.org/3.8/library/typing.html#typing.TypedDict" target="_blank" rel="noopener noreferrer"><code>Typed
Dicts</code></a>,
introduced in Python3.8</li></ul></li></ul></li></ul><p><strong>Use <em>bare</em> type hints over <a href="https://peps.python.org/pep-0484/#runtime-or-type-checking" target="_blank" rel="noopener noreferrer">ones with
quotes</a> and <code>if
tying.TYPE_CHECKING:</code></strong></p><ul><li>Quoted type hints enable &quot;foreward references&quot;. This enables us to not
execute expencive code while still having type checks.</li><li>As long as the performance is immesurable small and not a problem, this
should be avoided, since it &gt; [name=Joel Dierkes] Dunno about this part. Should
we use <code>if typing.TYPE_CHECKING:</code> and quoted types or avoid them?</li></ul><p><strong>Be as specific as possible</strong></p><ul><li>If the types of the keys and values of a dict are known, specify
them. (E.g. Use <code>Dict[str, str]</code> over <code>Dict</code>).</li><li>If the types of all items in a list are known, specify them
(E.g. <code>List[int]</code> over <code>List</code>)</li><li>...</li></ul><p><strong>Avoid <code>Dicts</code></strong></p><ul><li>Strongly typed structures should be prefered, since they are more
descriptive and easier to use in the future.</li><li>&quot;Was the id key in the <code>Dict</code> named <code>_id</code> or <code>id</code>?&quot; is a question that
should not occur.</li></ul><p><strong>Avoid the <code>Optional</code> type</strong></p><ul><li>The <code>Optional</code> type highlights that a value <em>might</em> be <code>None</code>. As a result
the value <em>has</em> to be checked for <code>None</code> on every usage (<code>if value: </code>).</li><li>While sometimes this cannot be avoided, the <code>Optional</code> type should be used
spearly. Most of the times a propper initialization of the variable is
enough to get rid of it. If it makes sense that a type can be
&quot;non-existent&quot;, it is appropriate to use the <code>Option</code> type.</li></ul><p><strong>Avoid the <code>Union</code> type</strong></p><ul><li>The <code>Union</code> type indicates, that one of multiple different types may be
returned. This can be confusing and resolves in the need of testing, which
type is returned.</li><li>Split the function or variable, which used the <code>Union</code> type, in multiple
ones. This resolves in more readable code and is unambiguous. This also
follows the <code>A function does one, and only one thing</code> rule.</li></ul><p><strong>Use
<a href="https://docs.python.org/3/library/typing.html#typing.NoReturn" target="_blank" rel="noopener noreferrer"><code>typing.NoReturn</code></a></strong></p><ul><li>It is used to indicate a never terminating function (e.g. <code>while
True:</code>). Use this annotation to indicate these kind of functions.</li></ul><p><strong>Use
<a href="https://docs.python.org/3/library/typing.html#typing.Iterator" target="_blank" rel="noopener noreferrer"><code>typing.Iterator</code></a>
over
<a href="https://docs.python.org/3/library/typing.html#typing.Generator" target="_blank" rel="noopener noreferrer"><code>typing.Generator</code></a></strong></p><ul><li><code>typing.Generator[YieldType, SendType, ReturnType]</code> takes three Type Vars:
The Type that gets yielded, the type that gets send back to the yield, and the
return type of the function. If a function does only yield values, but does
not take back values from the yield and also does not return anything with the
<code>return</code> keyword, the type is <code>typing.Generator[YieldType, None, None]</code>. This
is equivalent to <code>typing.Iterator[YieldType]</code>. We favor the <code>Iterator</code>
approach over the <code>Generator</code> one because it&#x27;s more understandable and easier
to read.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="common-types"></a>Common Types<a class="hash-link" href="#common-types" title="Direct link to heading">#</a></h3><p>To ensure a consistent use of type annotations in Rucio, here is a list of
common variables with their corresponding type:</p><table><thead><tr><th>Code section</th><th>Variable</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>*</td><td>session</td><td>sqlalchemy.orm.session.Session</td><td>The sqlalchemy session.</td></tr><tr><td>DID</td><td>scope</td><td><code>str</code></td><td>The scope of a DID.</td></tr><tr><td>DID</td><td>name</td><td><code>str</code></td><td>The name of a DID.</td></tr><tr><td>DID</td><td>account</td><td><code>str</code></td><td>The account name.</td></tr><tr><td>DID</td><td>did_type</td><td><code>str</code></td><td>The DID type.</td></tr></tbody></table></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/rucio/documentation/tree/main/docs/../docs/type_annotation_guide.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2022-10-26T15:49:44.000Z" class="lastUpdatedDate_nN9m">10/26/2022</time> by <strong>Rizart Dona</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/documentation/component_leads"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Component development leads</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/documentation/about_our_contributors"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">About Our Contributors Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstract" class="table-of-contents__link">Abstract</a></li><li><a href="#type-annotations" class="table-of-contents__link">Type Annotations</a><ul><li><a href="#general-information" class="table-of-contents__link">General Information</a></li><li><a href="#syntax" class="table-of-contents__link">Syntax</a></li></ul></li><li><a href="#why" class="table-of-contents__link">Why</a></li><li><a href="#type-annotations-in-rucio" class="table-of-contents__link">Type Annotations in Rucio</a><ul><li><a href="#what-not-to-type-annotate" class="table-of-contents__link">What not to type annotate</a></li><li><a href="#dependencies" class="table-of-contents__link">Dependencies</a></li><li><a href="#github-actions" class="table-of-contents__link">GitHub Actions</a></li><li><a href="#best-practices" class="table-of-contents__link">Best Practices</a></li><li><a href="#common-types" class="table-of-contents__link">Common Types</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></div><div class="footer__copyright">Copyright Â© 2022 CERN</div></div></div></footer></div>
<script src="/documentation/assets/js/styles.0e925561.js"></script>
<script src="/documentation/assets/js/runtime~main.ca0eb878.js"></script>
<script src="/documentation/assets/js/main.b4a61254.js"></script>
<script src="/documentation/assets/js/1.c84e6daf.js"></script>
<script src="/documentation/assets/js/2.e9cef96e.js"></script>
<script src="/documentation/assets/js/378.e0a12efe.js"></script>
<script src="/documentation/assets/js/381.ba0865de.js"></script>
<script src="/documentation/assets/js/935f2afb.367d78a1.js"></script>
<script src="/documentation/assets/js/17896441.35502a5f.js"></script>
<script src="/documentation/assets/js/f8659546.095d8f14.js"></script>
</body>
</html>